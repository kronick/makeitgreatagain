<!doctype html>
<head>
<meta charset="utf-8">
<title>Make It Great Again</title>
<link rel="stylesheet" href="style.css">
<script src="jquery-2.1.4.min.js" type="text/javascript"></script>

<script type="text/javascript">
$(document).ready(function() {
    $('body').attr("spellcheck",false)

    var div = document.getElementById("whateveritis");

    div.onfocus = function() {
        window.setTimeout(function() {
            var sel, range;
            if (window.getSelection && document.createRange) {
                range = document.createRange();
                range.selectNodeContents(div);
                sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            } else if (document.body.createTextRange) {
                range = document.body.createTextRange();
                range.moveToElementText(div);
                range.select();
            }
        }, 1);
    };    

    start_text = location.hash.split(",")[1]
    color = location.hash.split(",")[0].substring(1)
    if(start_text) {
        $("#whateveritis").text(decodeURIComponent(start_text));
        setTextHeight();
        setHatColor(color);
        $('#hatcolor option').filter(function() { 
            return ($(this).text().toLowerCase() == color); 
        }).prop('selected', true);

        updateHash();
    }

    $("#whateveritis").on("blur keyup keydown paste input", function() {
        //$("#whateveritis").text($("#whateveritis").text())
        setTextHeight();
    })
    $("#whateveritis").on("blur", function() {
        updateHash();
    })
    $("#hatcolor").on("change", function() {
        setHatColor($("#hatcolor").val());
        updateHash();
    });
});

function setHatColor(color) {
    if(color == "red") {
        $("#hat").attr("src", "hats/red.jpg");
        $("#hattext").removeClass("gold black")
        $("#hattext").addClass("white");
    }
    else if(color == "white") {
        $("#hat").attr("src", "hats/white.jpg");
        $("#hattext").removeClass("white black")
        $("#hattext").addClass("gold");
    }
    else if(color == "black") {
        $("#hat").attr("src", "hats/black.jpg");
        $("#hattext").removeClass("gold black")
        $("#hattext").addClass("white");
    }
}

function setTextHeight() {
    min_height = 100;
    max_height = 180;

    while($("#hattext").height() > max_height) {
            $("#hattext").css("font-size", "-=1px");
            console.log($("#hattext").height() )
        }

        while($("#hattext").height() <= min_height) {
            $("#hattext").css("font-size", "+=1px");
            console.log($("#hattext").height() )
        }
}
function updateHash() {
    location.hash = $("#hatcolor").val() + "," + encodeURIComponent($("#whateveritis").text())
    $("title").text($("#hattext").text().toUpperCase());
    $("#fb-share").data("href", location.href)

}
</script>
</head>

<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "http://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div id="hatbox">
    <img src="hats/white.jpg" id="hat">
    <div id="hattext">MAKE <span id="whateveritis" contenteditable>AMERICA</span><br> GREAT AGAIN</div>
</div>

<div id="options">
    <label for="hatcolor">Color: </label>
    <select name="hatcolor" id="hatcolor">
        <option value="white">White</option>
        <option value="red">Red</option>
        <option value="black">Black</option>
    </select>

    <br>
    <a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-hashtags="makeitgreatagain">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <div id="fb-share" class="fb-share-button" data-href="http://makeitgreatagain.horse" data-layout="button"></div>

    <div id="credit">
    Made by <a href="http://diskcact.us">ğŸ’¾ğŸŒµ</a> on a plane âœˆï¸âœˆï¸âœˆï¸
    </div>

</div>



</body>